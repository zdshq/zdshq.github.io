{"title":"how to edit makefile","uid":"6fc7f970a8bdd0db8488c948c20eb0ef","slug":"hello-world","date":"2023-07-16T03:00:00.000Z","updated":"2023-07-16T06:16:28.787Z","comments":true,"path":"api/articles/hello-world.json","cover":"/images/smile.jpeg","content":"<div class=\"custom-quote tip\">\n<span class=\"custom-quote-svg\"><svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"\" xmlns=\"http://www.w3.org/2000/svg\" data-reactroot=\"\">\n<path fill=\"\" d=\"M20.86 14.13C20 14.7 19.56 15.74 19.77 16.76C20.13 18.55 18.55 20.13 16.76 19.77C15.74 19.57 14.7 20 14.13 20.86C13.12 22.38 10.89 22.38 9.88 20.86C9.3 20 8.26 19.56 7.24 19.77C5.45 20.13 3.87 18.55 4.23 16.76C4.43 15.74 4 14.7 3.14 14.13C1.62 13.12 1.62 10.89 3.14 9.88C4 9.3 4.44 8.26 4.23 7.24C3.87 5.45 5.45 3.87 7.24 4.23C8.26 4.44 9.3 4 9.87 3.14C10.88 1.62 13.11 1.62 14.12 3.14C14.7 4 15.74 4.44 16.76 4.23C18.55 3.87 20.13 5.45 19.77 7.24C19.56 8.26 20 9.3 20.86 9.87C22.38 10.88 22.38 13.12 20.86 14.13Z\" undefined=\"1\"></path>\n<path stroke-linejoin=\"round\" stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M12.01 15C12.01 14.5 12.01 14.5 12.01 14.5C12.04 13.75 13 13.46 14.04 12.2C14.41 11.74 14.69 11.41 14.86 10.85C15.15 9.95 14.92 9.18 14.86 9.02C14.8 8.79 14.52 8 13.72 7.46C13.06 7.02 12.42 7 12.14 7C11.9 7 11.36 7 10.78 7.3C10.28 7.56 9.98 7.9 9.83 8.1C9.24 8.82 9.06 9.63 9 10.06\"></path>\n<path stroke-linecap=\"round\" stroke-miterlimit=\"10\" stroke-width=\"2\" stroke=\"\" d=\"M11.99 18H12.01\"></path>\n</svg></span>\n<p class=\"custom-quote-title\">提示</p>\n<p>众所周知  makefile是大型项目中不可缺少的一部分，往往在网上学习大型项目时，都需要去阅读makefile，自己在写项目时，有时候也需要自己去编写自己项目的makefile，从而能够帮助大家在项目开发中不会在编译这一块花费太多的时间。本人也是最近在学习<a href=\"https://nju-projectn.github.io/ics-pa-gitbook/ics2022/index.html\">一生一芯PA</a>，在PA2中需要自己去手动改一下makefile，所以出了一下的教程，本文也会从实践出发，不会长篇大论，一起去写一个简单到复杂然后从实践去理解makefile编写的语法！</p>\n</div>\n<h2 id=\"一个简单的makefile\"><a href=\"#一个简单的makefile\" class=\"headerlink\" title=\"一个简单的makefile\"></a>一个简单的makefile</h2><pre class=\"line-numbers language-makefile\" data-language=\"makefile\"><code class=\"language-makefile\"><span class=\"token comment\"># Makefile</span>\n<span class=\"token target symbol\">all</span><span class=\"token punctuation\">:</span> main\n\n<span class=\"token target symbol\">main</span><span class=\"token punctuation\">:</span> main.c\n\tgcc -o main main.c<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>通过终端我们可以输入以下命令去编译生成main：</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> all<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>上述makefile是编译一个C语言源文件main.c，相信大家对于这种简单的makefile不需要去说就能猜到他是怎么编译的吧。<br>首先我们我们通过make带入的参数all去找到这一行</p>\n<pre class=\"line-numbers language-makefile\" data-language=\"makefile\"><code class=\"language-makefile\"><span class=\"token comment\"># Makefile</span>\n<span class=\"token target symbol\">all</span><span class=\"token punctuation\">:</span> main<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n<p>然而，这行代码是什么意思呢？<br>这就是makefile的规则<br>target: prerequisites<br>  command<br>…<br>…<br>target就是你要得到的目标，prerequisites是你的依赖，command是你的命令，它们之间的关系是：<br>prerequisites -&gt; command -&gt; target</p>\n<p>所以当make找到 all: main 这一行之后，首先会去查看依赖是否存在，如果不存在，就会去在已有的规则里面去寻找target为main的规则，从而生成all所需要的依赖<br>然后我们显而易见的就找到了这一行：</p>\n<pre class=\"line-numbers language-makefile\" data-language=\"makefile\"><code class=\"language-makefile\"><span class=\"token comment\"># Makefile</span>\n<span class=\"token target symbol\">main</span><span class=\"token punctuation\">:</span> main.c\n\tgcc -o main main.c<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>我们发现这一个规则刚好就是为了生成main而编写的，而他的依赖存在吗？<br>很明显，它存在，然后就运行gcc -o main main.c这一条命令，生成main。当 main 这个目标文件生成后，all 的依赖就已经满足了，因此 make all 这个命令就执行完成了<br>这就是一个最初始的makefile文件！</p>\n<h2 id=\"加入变量和多个文件编译的makefile-进阶版\"><a href=\"#加入变量和多个文件编译的makefile-进阶版\" class=\"headerlink\" title=\"加入变量和多个文件编译的makefile(进阶版)\"></a>加入变量和多个文件编译的makefile(进阶版)</h2><pre class=\"line-numbers language-makefile\" data-language=\"makefile\"><code class=\"language-makefile\"><span class=\"token comment\"># Makefile</span>\nCC <span class=\"token operator\">=</span> gcc\n\nCFLAGS <span class=\"token operator\">=</span> -Wall -g\n\nTarget <span class=\"token operator\">=</span> main\n\nSRCS <span class=\"token operator\">=</span> <span class=\"token variable\">$</span><span class=\"token punctuation\">(</span><span class=\"token function\">wildcard</span> ./*.c<span class=\"token punctuation\">)</span>\n\nOBJS <span class=\"token operator\">=</span> <span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>SRCS<span class=\"token punctuation\">:</span>.c<span class=\"token operator\">=</span>.o<span class=\"token punctuation\">)</span>\n\n<span class=\"token target symbol\">all</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>Target<span class=\"token punctuation\">)</span>\n\n<span class=\"token target symbol\"><span class=\"token variable\">$</span>(Target)</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>OBJS<span class=\"token punctuation\">)</span>\n\t<span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>CC<span class=\"token punctuation\">)</span> <span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>CFLAGS<span class=\"token punctuation\">)</span> -o <span class=\"token variable\">$@</span> <span class=\"token variable\">$^</span>\n\n<span class=\"token target symbol\">%.o</span><span class=\"token punctuation\">:</span> %.c\n\t<span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>CC<span class=\"token punctuation\">)</span> <span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>CFLAGS<span class=\"token punctuation\">)</span> -c <span class=\"token variable\">$&lt;</span> -o <span class=\"token variable\">$@</span> <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n<p>首先就是变量的格式 </p>\n<pre class=\"line-numbers language-makefile\" data-language=\"makefile\"><code class=\"language-makefile\">Variable <span class=\"token operator\">=</span> 值<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>调用的格式是<br>$(Variable)<br>然后就再来说说这两行代码</p>\n<pre class=\"line-numbers language-makefile\" data-language=\"makefile\"><code class=\"language-makefile\">SRCS <span class=\"token operator\">=</span> <span class=\"token variable\">$</span><span class=\"token punctuation\">(</span><span class=\"token function\">wildcard</span> ./*.c<span class=\"token punctuation\">)</span>\n\nOBJS <span class=\"token operator\">=</span> <span class=\"token variable\">$</span><span class=\"token punctuation\">(</span>SRCS<span class=\"token punctuation\">:</span>.c<span class=\"token operator\">=</span>.o<span class=\"token punctuation\">)</span><span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span></span></code></pre>\n<p>首先是SRCS &#x3D; $(wildcard .&#x2F;*.c)，这个变量的命名是调用了一个叫做wildcard的函数，暂时不需要管，我们会在下面提到，现在我们只需要知道，他会通过通配符去匹配在当前目录下的所有的.c文件并且返回给SRCS。<br>然后就是OBJS &#x3D; $(SRCS:.c&#x3D;.o)，这个变量的主要作用就是及时的</p>\n","feature":true,"text":" 提示 众所周知 makefile是大型项目中不可缺少的一部分，往往在网上学习大型项目时，都需要去阅读makefile，自己在写项目时，有时候也需要自己去编写自己项目的makefile，从而能够帮助大家在项目开发中不会在编译这一块花费太多的时间。本人也是最近在学习一生一芯PA，在...","link":"","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"Makefile","slug":"Makefile","count":1,"path":"api/categories/Makefile.json"}],"tags":[{"name":"makefile","slug":"makefile","count":1,"path":"api/tags/makefile.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84makefile\"><span class=\"toc-text\">一个简单的makefile</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%8A%A0%E5%85%A5%E5%8F%98%E9%87%8F%E5%92%8C%E5%A4%9A%E4%B8%AA%E6%96%87%E4%BB%B6%E7%BC%96%E8%AF%91%E7%9A%84makefile-%E8%BF%9B%E9%98%B6%E7%89%88\"><span class=\"toc-text\">加入变量和多个文件编译的makefile(进阶版)</span></a></li></ol>","author":{"name":"zds","slug":"blog-author","avatar":"/images/smile.jpeg","link":"/","description":"<br>一位正在重塑知识的技术人 <br /> @ <b>张大帅</b>","socials":{"github":"https://github.com/zdshq","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/ze-ze-ze-88-82","csdn":"https://blog.csdn.net/qq_51976127?spm=1000.2115.3001.5343","juejin":"","customs":{}}},"mapped":true,"prev_post":{},"next_post":{"title":"Article Title","uid":"a6b82868af4785482b869dc5d958966b","slug":"hello-world（复件）","date":"2020-08-15T10:49:36.000Z","updated":"2023-07-15T17:08:08.965Z","comments":true,"path":"api/articles/hello-world（复件）.json","cover":"/images/smile.jpeg","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the ...","link":"","photos":[],"count_time":{"symbolsCount":430,"symbolsTime":"1 mins."},"categories":[{"name":"技术2","slug":"技术2","count":2,"path":"api/categories/技术2.json"}],"tags":[{"name":"技术1","slug":"技术1","count":2,"path":"api/tags/技术1.json"}],"author":{"name":"zds","slug":"blog-author","avatar":"/images/smile.jpeg","link":"/","description":"<br>一位正在重塑知识的技术人 <br /> @ <b>张大帅</b>","socials":{"github":"https://github.com/zdshq","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"https://www.zhihu.com/people/ze-ze-ze-88-82","csdn":"https://blog.csdn.net/qq_51976127?spm=1000.2115.3001.5343","juejin":"","customs":{}}},"feature":true}}